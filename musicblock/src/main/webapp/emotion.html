<!DOCTYPE html>
<html>

<head>
<title>Music Block</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<!-- tag script -->
<script src="https://code.jquery.com/jquery-1.7.js"></script>

<!-- auto complete -->
<link rel="stylesheet"
	href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
<script src="//code.jquery.com/jquery-1.7.js"></script>
<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

<!-- bootstrap script -->
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

<!-- Common Module -->
<link rel="stylesheet" type="text/css" href="css/common/commonMenu.css">
<link rel="stylesheet" type="text/css" href="css/emotion/emotion.css">

<script>
	var count = 0;
	var i=0;
	
	//validation check
	function fncValidate(){
		
		var eCount=0;
		var upload=document.getElementById("check");
		
		var emotion=new Array;
		var kind=new Array('yellow','red','violet','orange','blue');
		
		for(i=0;i<kind.length;i++){
			emotion[i]=$("#icon"+i).attr('src');
		}		
		
		for(i=0;i<kind.length;i++){
			//alert(emotion[i]+'///images/smile_'+kind[i]+'_clicked.png');
			if(emotion[i]=='images/smile_'+kind[i]+'_clicked.png'){
				eCount++;
				emotion[i]="that";
			}
		}
		
		if(eCount==0){
			alert("감정은 필수 사항입니다.");
		}else{
			alert("선택된 감정 갯수 : "+eCount);
			if(upload.checked){
				sendServer(emotion);
			}else{
				alert("local 에 저장 여기수정하겠습니다");
			}
		}
	};
	
	//Save to Server&Local
	function sendServer(upload,emotion){
		alert(emotion);
		
		var dummyNote = location.href.substr(location.href
				.lastIndexOf('=') + 1);
		//"미2,레#2,솔1,파#4,라3";
		var dummyHashCodes = "김은혜시코드,KimEunHyeshCode,김은혜씨코드,KimEunHashCode";
		var dummyEmotion = "3";

		$
				.ajax({ //$.post(), $.get(), $.getJSON 등도 있음
					url : 'block/blockSave',
					type : 'POST' //Request하는 방식.

					,
					data : JSON.stringify({ //JSON.stringify를 해줘야 제대로 된 형태의 JSON이 날아감
						emotion : dummyEmotion,
						note : dummyNote,
						hashCode : dummyHashCodes
					}),
					dataType : "json" //Response로 오는 방식. Request 타입을 지정하는 것으로 착각하기 쉬우므로 주의.

					,
					contentType : 'application/json;charset=UTF-8' //POST방식일 때 사용. 인코딩 안해주면 한글 깨져서 전송됨

					,
					success : function(data, status) {
						console.log(status);
						console.log("JSONData : "
								+ JSON.stringify(data));
						/*$("body").append("<div id='save-popup'><div id='popup-btn1'>1</div><div id='popup-btn2'>2</div><div style='top:40%;position:relative;'><font size='1px' color='red'>"+JSON.stringify(data)+"</font></div></div>");*/
						$("body")
								.append(
										"<div id='save-popup'><center><br>성공적으로 전송되었습니다</center><div id='popup-btn1'><center>블럭 추가</center></div><div id='popup-btn2'><center>작곡 화면<br>(3초 후 자동 이동)</center></div></div>");
						$("#popup-btn1").click(function() {
							$("#save-popup").remove();
							location.href = "blockMaking.html";
						});
						$("#popup-btn2").click(function() {
							$("#save-popup").remove();
							location.href = "composeMusic.html";
						});
						$("#save-popup")
								.delay(3000)
								.fadeOut(
										500,
										function() {
											$("#save-popup")
													.remove();
											location.href = "composeMusic.html";
										});
					},
					error : function(status) {
						console.log(status);
					}
				})

	}
	
	//tag 추가 function
	$(function() {
		$("#put").click(function() {
			var what = $("#user-input").val();
			//$("#user-tag").append("<span>#"+what+"</span>");
			$("#user-tag").append('<span id="test' + count + '">#' + what);
			count++;
			$("#user-input").val(""); // 입력텍스트 초기화
			//$("#user-tag").empty();
		});
	});

	//tag 삭제 function
	$(function() {
		$("span").live('click', function() { // 위에 jquery 버전 바꾸면 동작안함

			var tagId = $(this).attr("id");

			if (tagId != 'menu') {
				$("#" + tagId).remove();
			}
		});
	});

	//emotion check function
	$(function() {
		var emotion = $('.icon');
		emotion.live('click', function() {
			var checkIcon = $(this).attr('src');
			if (checkIcon == 'images/smile_yellow.png') {
				$(this).attr('src', 'images/smile_yellow_clicked.png');
				flag = false;
			} else if (checkIcon == 'images/smile_yellow_clicked.png') {
				$(this).attr('src', 'images/smile_yellow.png');
				flag = true;
			} else if (checkIcon == 'images/smile_red.png') {
				$(this).attr('src', 'images/smile_red_clicked.png');
				flag = true;
			} else if (checkIcon == 'images/smile_red_clicked.png') {
				$(this).attr('src', 'images/smile_red.png');
				flag = true;
			} else if (checkIcon == 'images/smile_violet.png') {
				$(this).attr('src', 'images/smile_violet_clicked.png');
				flag = true;
			} else if (checkIcon == 'images/smile_violet_clicked.png') {
				$(this).attr('src', 'images/smile_violet.png');
				flag = true;
			} else if (checkIcon == 'images/smile_orange.png') {
				$(this).attr('src', 'images/smile_orange_clicked.png');
				flag = true;
			} else if (checkIcon == 'images/smile_orange_clicked.png') {
				$(this).attr('src', 'images/smile_orange.png');
				flag = true;
			} else if (checkIcon == 'images/smile_blue.png') {
				$(this).attr('src', 'images/smile_blue_clicked.png');
				flag = true;
			} else if (checkIcon == 'images/smile_blue_clicked.png') {
				$(this).attr('src', 'images/smile_blue.png');
				flag = true;
			}
		});
	});

	// auto complete function
	$(function() {
		var availableTags = [ "happy"

		, "happiness"

		, "hello" ];
		$("#tag").autocomplete({
			source : availableTags
		});
	});


</script>
</head>

<body>
	<!--공통모듈 : 메뉴바-->
	<script src="/javascript/common/commonMenu.js"></script>
	<div id="background">
		<form name="detailForm" >
		<div id="emotion-container">
			<center>
				<img class="icon" id="icon0" src="images/smile_yellow.png"
					style="width: 15%; height: 20%" /> 
					<img class="icon" id="icon1"
					src="images/smile_red.png" style="width: 15%; height: 20%" /> 
					<img
					class="icon" id="icon2" src="images/smile_violet.png"
					style="width: 15%; height: 20%" /> 
					<img class="icon" id="icon3"
					src="images/smile_orange.png" style="width: 15%; height: 20%" /> 
					<img
					class="icon" id="icon4" src="images/smile_blue.png"
					style="width: 15%; height: 20%" />
			</center>
		</div>

		<div class="whiteSpace"></div>

		<div class="form-inline">
			<div id="ui-field-contain">
				
				<label for="title">Name Input</label> 
				<input id="title" type="text" placeholder="here Title"> <br> 
				
				<label for="tag">Tag Input </label> 
				<input id="tag"	type="text" placeholder="here Tag">
				
			</div>
			
			<div id="user-tag"></div>
			
			<div id="save-container">
				<input type="checkbox" id="check" value="g2"> Upload to ShareBox 
				<a href="javascript:fncValidate();" id="save">Save</a>
				
			</div>
		</div>
		</form>
	</div>
</body>

</html>